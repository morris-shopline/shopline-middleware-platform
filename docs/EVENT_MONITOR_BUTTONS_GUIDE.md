# Event Bus 功能測試儀表板 - 按鈕行為說明

## 🎯 核心目的
**讓用戶直觀地測試 Event Bus 的核心功能：事件發布、訂閱、監控、持久化**

## 📊 統計數字說明
- **右上角「資料庫總事件數」**：顯示資料庫中所有事件的總數
- **下方統計卡片**：顯示當前 log 顯示區域中的事件統計
- **最後事件時間**：顯示最新事件的真實時間戳（非前端處理時間）

## 📋 按鈕功能定義

### 1. **開始監控** (▶️ 開始監控)
- **測試目的**：驗證 Event Bus 的**實時監控**功能
- **行為**：
  - 建立 Server-Sent Events (SSE) 連接
  - 即時接收事件推送，無需輪詢
  - 狀態指示器顯示「線上」
- **測試重點**：確認事件發布後能即時被監控到
- **使用時機**：想要測試實時事件流時

### 2. **停止監控** (⏹️ 停止監控)
- **測試目的**：驗證監控狀態的**開關控制**功能
- **行為**：
  - 關閉 SSE 連接
  - 不再接收事件推送（但事件仍會正常發布）
  - 狀態指示器顯示「離線」
- **測試重點**：確認監控狀態不影響事件發布
- **使用時機**：想要測試監控控制功能時

### 3. **載入歷史事件** (🔄 載入歷史事件(100筆))
- **測試目的**：驗證 Event Bus 的**事件持久化**功能
- **行為**：
  - 調用 `/api/event-monitor/events` 獲取最近 100 個事件
  - 重新顯示所有歷史事件
  - 更新事件計數器
- **測試重點**：確認事件已正確保存到資料庫
- **使用時機**：想要測試事件持久化功能時

### 4. **測試事件發布** (🧪 測試事件發布)
- **測試目的**：驗證 Event Bus 的**事件發布**功能
- **行為**：
  - 調用 `/api/event-monitor/test-simple`
  - 發布 `product.updated` 事件到 Event Bus
  - 事件會保存到資料庫
- **測試重點**：確認事件能成功發布並保存
- **使用時機**：想要測試事件發布功能時

### 5. **清除顯示** (🗑️ 清除顯示)
- **測試目的**：驗證**前端顯示控制**功能
- **行為**：
  - 清空事件列表顯示
  - 重置事件計數器
  - **不影響資料庫中的事件**
- **測試重點**：確認顯示控制不影響數據
- **使用時機**：想要重新開始測試時

## 🔍 重要概念澄清

### 監控 vs 事件發布
- **監控**：控制前端是否**顯示**新事件
- **事件發布**：實際的業務邏輯，**不受監控狀態影響**

### 事件來源
- **實時監控**：只顯示監控啟動後的新事件
- **手動刷新**：顯示資料庫中所有歷史事件（包括 OAuth 授權事件等）

### 測試事件行為
- 測試事件**總是會發布**，無論監控狀態如何
- 如果監控已停止，測試事件不會立即顯示，但會保存到資料庫
- 手動刷新後可以看到測試事件

## 🐛 常見問題

### Q: 為什麼停止監控後，測試事件不會顯示？
A: 因為停止監控後，前端不再輪詢新事件。但事件已經發布到資料庫，手動刷新即可看到。

### Q: 為什麼手動刷新會顯示 auth 相關事件？
A: 手動刷新會顯示資料庫中所有歷史事件，包括 OAuth 授權時發布的事件。

### Q: 監控狀態會影響事件發布嗎？
A: **不會**。事件發布是獨立的業務邏輯，監控只是控制前端顯示。

## 📊 用戶測試流程

### 🧪 Event Bus 核心功能測試
1. **測試事件發布**：點擊「測試事件發布」→ 觀察新事件出現
2. **測試實時監控**：開始監控 → 再次測試事件發布 → 觀察即時顯示
3. **測試監控控制**：停止監控 → 測試事件發布 → 確認不顯示
4. **測試事件持久化**：載入歷史事件(100筆) → 查看所有保存的事件

### 🔄 業務流程整合測試
1. **OAuth 授權測試**：在另一頁面進行 OAuth → 觀察授權事件
2. **API 操作測試**：進行商品/訂單操作 → 觀察相關事件
3. **完整流程測試**：授權 → API 操作 → 監控事件流 → 驗證持久化

## 🔧 技術實作

- **監控方式**：Server-Sent Events (SSE) 訂閱模式
- **事件限制**：最近 100 個事件
- **資料庫**：PostgreSQL
- **事件總線**：內建 Event Bus
- **API 端點**：`/api/event-monitor/events`、`/api/event-monitor/stream`
- **時間戳**：使用事件真實時間戳，非前端處理時間
